                                ∆ΙΚΤΥΑ ΕΠΙΚΟΙΝΩΝΙΩΝ
                                Εργαστηριακή Άσκηση 7
                   ∆ρομολόγηση ∆ιανύσματος Αποστάσεων


1.       Eισαγωγή
Σε αυτή την άσκηση θα μελετηθεί η επίδοση του πρωτοκόλλου δρομολόγησης διανύσματος αποστάσεων
(distance vector - DV). Η λειτουργία του πρωτοκόλλου αυτού περιγράφεται αναλυτικά στο 5ο
κεφάλαιο του βιβλίου «Δίκτυα Υπολογιστών» (A. Tanenbaum).
Η άσκηση περιλαμβάνει δύο μέρη. Στο πρώτο μέρος θα δημιουργηθεί ένα δίκτυο με σύνθετη
τοπολογία με την οποία θα επαληθευθεί η λειτουργία του πρωτοκόλλου δρομολόγησης DV. Στο
δεύτερο μέρος θα παρατηρηθεί ότι για τοπολογίες συγκεκριμένης μορφής το πρωτόκολλο DV
αποτυγχάνει.


2.       Επαλήθευση πρωτοκόλλου DV
Αρχικά δημιουργούμε το δίκτυο του Σχήματος 1, όπου ο αριθμός πάνω σε κάθε ζεύξη αναπαριστά το
κόστος μετάδοσης μέσω αυτής.




                         Σχήμα 1: Τοπολογία πρώτου μέρους της άσκησης

Ο τρόπος με τον οποίο δημιουργείται αυτή η τοπολογία σας είναι ήδη γνωστός, με βάση τις
προηγούμενες ασκήσεις. Ο κόμβος C στέλνει κίνηση CBR πάνω από UDP προς τον κόμβο A και ο
κόμβος F στον D.
Ο κώδικας για την εκτέλεση αυτού του σεναρίου βρίσκεται στο Παράρτημα A.


2.1      Ερωτήσεις
        Ποιες διαδρομές ακολουθούν τα πακέτα για τις δύο μεταδόσεις;
        Να εκτελέσετε με το χέρι τον αλγόριθμο διανύσματος αποστάσεων και να επαληθεύσετε την
         ορθή λειτουργία του πρωτοκόλλου.
        Ποιο είναι το μέγιστο κόστος μετάδοσης της ζεύξης D-E, ώστε να διατηρούνται βέλτιστες οι
         διαδρομές που προσδιορίσατε στο προηγούμενο ερώτημα για τις δύο μεταδόσεις; Επαληθεύστε
         την απάντησή σας τόσο θεωρητικά (εκτέλεση αλγορίθμου DV με το χέρι), όσο και πειραματικά
                                                                                               1
         με τη βοήθεια του ΝS2.
        Ποια είναι η ελάχιστη μεταβολή τους κόστους μετάδοσης της ζεύξης C-F, η οποία θα οδηγήσει
         στη συμμετοχή της ζεύξης αυτής στη μία εκ των δύο βέλτιστων διαδρομών που προσδιορίσατε
         στο πρώτο ερώτημα για τις δύο μεταδόσεις και άρα στην τροποποίησή της; Επαληθεύστε την
         απάντησή σας τόσο θεωρητικά (εκτέλεση αλγορίθμου DV με το χέρι), όσο και πειραματικά με
         τη βοήθεια του ΝS2.
        Την χρονική στιγμή 1sec η γραμμή D-E τίθεται εκτός λειτουργίας. Ποιες διαδρομές
         ακολουθούν τώρα τα πακέτα για τις δύο ανωτέρω περιπτώσεις; Είναι οι συντομότερες
         διαθέσιμες διαδρομές;
        Στην αρχική τοπολογία, το κόστος της γραμμής D-E γίνεται 3. Ποιες είναι στην περίπτωση
         αυτή οι διαδρομές για τις δύο μεταδόσεις;


3.       Αποτυχία πρωτοκόλλου Distance Vector
Δημιουργήστε την τοπολογία του Σχήματος 2.




                                       Σχήμα 2: Τοπολογία 2

Το κόμβος C αποστέλλει κίνηση CBR ρυθμού 960 kbps προς τον κόμβο A, ενώ ο κόμβος D
αποστέλλει κίνηση CBR ρυθμού 960 kbps προς τον κόμβο B.
Τη χρονική στιγμή t=1sec, η ζεύξη B-A τίθεται εκτός λειτουργίας, ενώ τη χρονική στιγμή t=2sec,
αποκαθίσταται η λειτουργία της ζεύξης B-A.
Ο κώδικας για την εκτέλεση αυτού του σεναρίου βρίσκεται στο Παράρτημα B.


3.1      Ερωτήσεις
        Ποια διαδρομή ακολουθούν τα πακέτα που στέλνει ο κόμβος C πριν και μετά τη διακοπή της
         ζεύξης B-A; Εξηγήστε αυτή τη συμπεριφορά.
        Να δώσετε τα σχήματα του xgraph που δείχνουν τον ρυθμό άφιξης δεδομένων στους


                                                                                                2
    προορισμούς τους. Σχολιάστε τους παρατηρούμενους ρυθμούς άφιξης δεδομένων.
   Επηρεάζεται η ροή πακέτων από τον κόμβο D προς στον B λόγω της αστοχίας της ζεύξης B-A;
   Προτείνετε κάποια λύση για την αντιμετώπιση αυτής της συμπεριφοράς.
   Όσο η ζεύξη B-A είναι εκτός λειτουργίας, διαφοροποιείται καθόλου η κατάσταση εάν
    μεταβληθεί ο μέγιστος ρυθμός μετάδοσης που μπορεί να υποστηριχθεί από τις υπόλοιπες
    ζεύξεις; Αιτιολογείστε την απάντησή σας τόσο θεωρητικά, όσο και πειραματικά με τη βοήθεια
    του ΝS2.




                                                                                           3
4.    Παραρτήματα
Παράρτημα Α- Κώδικας για την προσομοίωση του πρώτου μέρους
### Αρχείο προσομοίωσης για μελέτη επίδοσης πρωτοκόλλου δρομολόγησης Distance
### Vector (DV). Το σενάριο αποτελείται από 6 κόμβους συδεδεμένους με ζεύξεις
### διαφορετικού βάρους, όπως φαίνεται στην παρακάτω τοπολογία:


###          B--3--C         Στην προσομοίωση, ο κόμβος A ονομάζεται n(0), ο B n(1),
###       2/|        /|\5    ο C n(2), ο D n(3), ο E n(4) και ο F n(5).
###       / |     / | \
###      A   2   3   1   F
###       \ | /      | /     Ο κόμβος C στέλνει κίνηση CBR στον Α.
###       1\|/       |/2     Ο κόμβος F στέλνει κίνηση CBR στον D.
###          D--1--E


### Τα αποτελέσματα καταγράφονται στα αρχεία lab7a.nam (NAM) και lab7a.tr
### (trace file). Επιπλέον, τα αρχεία lab7a1.tr και lab7a2.tr περιγράφουν την
### κίνηση συναρτήσει του χρόνου (Xgraph).


# Δημιουργία αντικειμένου προσομοίωσης
set ns [new Simulator]


# Δημιουργία αρχείου NAM
set nf [open lab7a.nam w]
$ns namtrace-all $nf


# Δημιουργία αρχείου trace
set trf [open lab7a.tr w]
$ns trace-all $trf


# Διαδικασία τερματισμού
proc finish {} {
      global ns nf f1 f2 trf
      $ns flush-trace
      close $nf
      close $f1
      close $f2
      close $trf
      exit 0
}


# Ορισμός πρωτοκόλλου δρομολόγησης
Agent/rtProto/Direct set preference_ 200


                                                                                       4
$ns rtproto DV


# Δημιουργία κόμβων δικτύου
for {set i 0} {$i < 6} {incr i} {
      set n($i) [$ns node]
}


# Δημιουργία ζεύξεων και ορισμός κόστους
$ns duplex-link $n(0) $n(1) 1Mb 20ms DropTail
$ns cost $n(0) $n(1) 2
$ns cost $n(1) $n(0) 2
$ns duplex-link $n(0) $n(3) 1Mb 10ms DropTail
$ns cost $n(0) $n(3) 1
$ns cost $n(3) $n(0) 1
$ns duplex-link $n(1) $n(2) 1Mb 30ms DropTail
$ns cost $n(1) $n(2) 3
$ns cost $n(2) $n(1) 3
$ns duplex-link $n(1) $n(3) 1Mb 20ms DropTail
$ns cost $n(1) $n(3) 2
$ns cost $n(3) $n(1) 2
$ns duplex-link $n(2) $n(3) 1Mb 30ms DropTail
$ns cost $n(2) $n(3) 3
$ns cost $n(3) $n(2) 3
$ns duplex-link $n(2) $n(4) 1Mb 10ms DropTail
$ns cost $n(2) $n(4) 1
$ns cost $n(4) $n(2) 1
$ns duplex-link $n(2) $n(5) 1Mb 50ms DropTail
$ns cost $n(2) $n(5) 5
$ns cost $n(5) $n(2) 5
$ns duplex-link $n(3) $n(4) 1Mb 10ms DropTail
$ns cost $n(3) $n(4) 1
$ns cost $n(4) $n(3) 1
$ns duplex-link $n(4) $n(5) 1Mb 20ms DropTail
$ns cost $n(4) $n(5) 2
$ns cost $n(5) $n(4) 2


# Στρώμα Μεταφοράς, κόμβος n(2): πηγή, κόμβος n(0): προορισμός
set udp1 [new Agent/UDP]
$ns attach-agent $n(2) $udp1
$udp1 set fid_ 1
$ns color 1 red
set sink1 [new Agent/LossMonitor]



                                                                 5
$ns attach-agent $n(0) $sink1


# Στρώμα Μεταφοράς, κόμβος n(5): πηγή, κόμβος n(3): προορισμός
set udp2 [new Agent/UDP]
$ns attach-agent $n(5) $udp2
$udp2 set fid_ 2
$ns color 2 blue
set sink2 [new Agent/LossMonitor]
$ns attach-agent $n(3) $sink2


# Σύνδεση των πηγών και των προορισμών
$ns connect $udp1 $sink1
$ns connect $udp2 $sink2


# Στρώμα εφαρμογής
set cbr1 [new Application/Traffic/CBR]
$cbr1 attach-agent $udp1
set cbr2 [new Application/Traffic/CBR]
$cbr2 attach-agent $udp2


# Διαδικασία καταγραφής κίνησης
proc record {} {
     global sink1 sink2 f1 f2
     set ns [Simulator instance]
     # Ορισμός του χρόνου που η διαδικασία θα ξανακληθεί
     set time 0.1
     # Καταγραφή των byte
     set bw1 [$sink1 set bytes_]
     set bw2 [$sink2 set bytes_]
     # Λήψη της τρέχουσας ώρας
     set now [$ns now]
     # Υπολογισμός του bandwidth και καταγραφή αυτού
     puts $f1 "$now [expr (($bw1/$time)*8)/1000000]"
     puts $f2 "$now [expr (($bw2/$time)*8)/1000000]"
     # Θέτει τη μεταβλητή bytes ίση με 0
     $sink1 set bytes_ 0
     $sink2 set bytes_ 0
     # Επαναπρογραμματισμός της διαδικασίας
     $ns at [expr $now+$time] "record"
}


# Δημιουργία αρχείων για το Xgraph



                                                                 6
set f1 [open lab7a1.tr w]
set f2 [open lab7a2.tr w]


# Ορισμός γεγονότων
$ns at 0.0 "record"
$ns at 0.3 "$cbr1 start"
$ns at 0.5 "$cbr2 start"
$ns at 2.5 "$cbr1 stop"
$ns at 2.5 "$cbr2 stop"
$ns at 3 "finish"
# Εκτέλεση προσομοίωσης
$ns run




                            7
Παράρτημα Β – Κώδικας για την προσομοίωση του δεύτερου μέρους
### Αρχείο προσομοίωσης για μελέτη επίδοσης πρωτοκόλλου δρομολόγησης Distance
### Vector (DV). Το σενάριο αποτελείται από 4 κόμβους συδεδεμένους με ζεύξεις,
### όπως φαίνεται στην παρακάτω τοπολογία:


###     10Mbps
###    C-------D       Στην προσομοίωση, ο κόμβος A ονομάζεται n(0), ο B n(1),
###     \         /    ο C n(2) και ο D n(3).
###   10Mbps 10Mbps
###         \ /
###         B
###         /          Ο κόμβος C στέλνει κίνηση CBR στον Α.
###     /10Mbps        Ο κόμβος D στέλνει κίνηση CBR στον B.
###    A


### Τα αποτελέσματα καταγράφονται στα αρχεία lab7b.nam (NAM) και lab7b.tr
### (trace file). Επιπλέον, τα αρχεία lab7b1.tr και lab7b2.tr περιγράφουν την
### κίνηση συναρτήσει του χρόνου (Xgraph).


# Δημιουργία αντικειμένου προσομοίωσης
set ns [new Simulator]


# Δημιουργία αρχείου NAM
set nf [open lab7b.nam w]
$ns namtrace-all $nf


# Δημιουργία αρχείου trace
set trf [open lab7b.tr w]
$ns trace-all $trf


# Διαδικασία τερματισμού
proc finish {} {
      global ns nf f1 f2 trf
      $ns flush-trace
      close $nf
      close $f1
      close $f2
      close $trf
      exit 0
}


# Ορισμός πρωτοκόλλου δρομολόγησης


                                                                                 8
Agent/rtProto/Direct set preference_ 200
$ns rtproto DV


# Δημιουργία κόμβων δικτύου
for {set i 0} {$i < 4} {incr i} {
      set n($i) [$ns node]
}


# Δημιουργία ζεύξεων
$ns duplex-link $n(0) $n(1) 1Mb 10ms DropTail
$ns duplex-link $n(1) $n(2) 1Mb 10ms DropTail
$ns duplex-link $n(1) $n(3) 1Mb 10ms DropTail
$ns duplex-link $n(2) $n(3) 1Mb 10ms DropTail


# Εμφάνιση ουράς αναμονής στο NAM
$ns duplex-link-op $n(2) $n(1) queuePos 0.5


# Στρώμα Μεταφοράς, κόμβος n(2): πηγή, κόμβος n(0): προορισμός
set udp1 [new Agent/UDP]
$ns attach-agent $n(2) $udp1
$udp1 set fid_ 1
$ns color 1 red
set sink1 [new Agent/LossMonitor]
$ns attach-agent $n(0) $sink1


# Στρώμα Μεταφοράς, κόμβος n(3): πηγή, κόμβος n(1): προορισμός
set udp2 [new Agent/UDP]
$ns attach-agent $n(3) $udp2
$udp2 set fid_ 2
$ns color 2 blue
set sink2 [new Agent/LossMonitor]
$ns attach-agent $n(1) $sink2


# Σύνδεση των πηγών και των προορισμών
$ns connect $udp1 $sink1
$ns connect $udp2 $sink2


# Στρώμα εφαρμογής
set cbr1 [new Application/Traffic/CBR]
$cbr1 attach-agent $udp1
$cbr1 set packetSize_ 600
$cbr1 set interval_ 0.005



                                                                 9
set cbr2 [new Application/Traffic/CBR]
$cbr2 attach-agent $udp2
$cbr2 set packetSize_ 600
$cbr2 set interval_ 0.005


# Διαδικασία καταγραφής κίνησης
proc record {} {
      global sink1 sink2 f1 f2
      set ns [Simulator instance]
      # Ορισμός του χρόνου που η διαδικασία θα ξανακληθεί
      set time 0.1
      # Καταγραφή των byte
      set bw1 [$sink1 set bytes_]
      set bw2 [$sink2 set bytes_]
      # Λήψη της τρέχουσας ώρας
      set now [$ns now]
      # Υπολογισμός του bandwidth και καταγραφή αυτού
      puts $f1 "$now [expr (($bw1/$time)*8)/1000000]"
      puts $f2 "$now [expr (($bw2/$time)*8)/1000000]"
      # Θέτει τη μεταβλητή bytes ίση με 0
      $sink1 set bytes_ 0
      $sink2 set bytes_ 0
      # Επαναπρογραμματισμός της διαδικασίας
      $ns at [expr $now+$time] "record"
}


# Δημιουργία αρχείων για το Xgraph
set f1 [open lab7b1.tr w]
set f2 [open lab7b2.tr w]


# Ορισμός γεγονότων
$ns at 0.0 "record"
$ns at 0.3 "$cbr1 start"
$ns at 0.3 "$cbr2 start"
$ns at 2.9 "$cbr1 stop"
$ns at 2.9 "$cbr2 stop"
$ns at 3 "finish"


# Διακοπή ζεύξης n(0)-n(1)
$ns rtmodel-at 1.0 down $n(0) $n(1)




                                                            10
# Επαναφορά ζεύξης n(0)-n(1)
$ns rtmodel-at 2.0 up $n(0) $n(1)


# Εκτέλεση προσομοίωσης
$ns run




                                    11
